# MyWhiteSSH - 动态SSH白名单自动更新工具

这是一个简单而强大的Shell脚本工具，用于在您的Linux VPS上自动维护一个基于URL的IP白名单，以增强SSH端口的安全性。


## ✨ WHY - 为啥会有这个脚本？

作为资深网上冲浪选手，长期拥有几个固定的IP是很正常的一件事。有鉴于此，可以将这些IP视为安全的白名单，将其他VPS的SSH访问权限设置为只允许这些白名单IP访问，可以杜绝白名单之外IP对SSH的恶意访问。我也知道有fail2ban这类工具，不过有心人士还是会变着法子用大量IP来恶意访问。所以，不如搞个白名单省事，对吧？

## ✨ 功能特性

- **一键安装**: 通过单个`wget`命令即可完成所有设置，无需手动配置。
- **交互式配置**: 安装过程以向导形式进行，引导用户输入必要信息。
- **安装前预览**: 在确认安装前，会实时从您提供的URL拉取内容进行预览，防止误操作。
- **智能IP解析**: 能自动处理带注释和多余空格的IP列表，只提取有效的IP地址用于防火墙规则。
- **自动更新规则**: 使用Cron设置每日任务，自动获取最新IP并更新UFW防火墙规则。
- **便捷命令行管理**: 提供一个简单的 `mywhitessh` 命令，用于随时查看、修改配置或手动更新。
- **在线升级**: 支持从您自己的GitHub仓库拉取最新版本并无缝更新脚本。
- **安全可靠**: 内置多重检查，如UFW状态检查、URL可访问性检查等，并在更新失败时中止以防锁定。
- **日志记录**: 所有后台操作都会记录在 `/var/log/mywhitessh_update.log` 中，便于追踪。

## 🚀 如何安装

在您的VPS上，使用 `root` 权限执行以下单行命令即可：

```bash
bash <(wget -qO- https://raw.githubusercontent.com/nivenchang/mywhitessh/refs/heads/main/install.sh)
```

> **注意**: 如果您fork了本脚本，且自行修改的话，请注意将上面的 `install.sh`  对应URL替换为您自己的GitHub名下的实际URL。

安装程序将会引导您完成以下步骤：
1.  检查 `UFW` 防火墙状态。
2.  提示您输入白名单来源URL，并展示内容预览供您确认。
3.  提示您输入SSH端口。
4.  完成安装并自动执行首次更新。

## 🛠️ 如何使用

安装完成后，您可以随时在终端中运行 `mywhitessh` 命令来管理您的配置。

```bash
sudo mywhitessh
```

您将会看到一个清晰的菜单，提供以下选项：
1.  **查看白名单来源URL及内容预览**: 显示当前URL，并实时拉取其内容进行展示。
2.  **修改白名单来源URL**: 更新IP列表的URL。
3.  **查看当前SSH端口**: 显示当前配置的SSH端口。
4.  **修改SSH端口**: 更新SSH端口。
5.  **手动执行一次白名单更新**: 立即运行一次更新，无需等待定时任务。
6.  **从GitHub更新此脚本**: 从您配置的 `SELF_URL` 下载并安装最新版本的脚本。
7.  **退出脚本**: 关闭管理菜单。

## 📋 先决条件

- 一个基于Linux的VPS (建议为 Debian/Ubuntu 或其他使用 `systemd` 和 `cron` 的系统)。
- 已安装并启用 `ufw` (Uncomplicated Firewall)。脚本在安装时会检查。
- 已安装 `curl` 和 `wget`。
- 以 `root` 或具有 `sudo` 权限的用户执行安装。

## ⚙️ 工作原理

1.  **安装脚本 (`install.sh`)**:
    - 作为一个安装向导，负责检查环境、收集用户配置（URL和端口）、并进行预览确认。
    - 在 `/etc/mywhitessh/` 目录下创建配置文件和核心更新脚本。
    - 在 `/usr/local/bin/` 目录下创建 `mywhitessh` 管理命令的快捷方式。
    - 在 `/etc/cron.d/` 下创建定时任务，设置为每天凌晨 `03:30` 运行。

2.  **核心脚本 (`update_ssh_whitelist.sh`)**:
    - 这是由Cron调度的后台脚本。
    - 它会读取配置文件，从指定URL下载IP列表。
    - **使用 `awk` 和 `grep` 解析内容，智能提取IP地址，忽略注释和空格。**
    - 清理所有旧的、针对SSH端口的 `UFW` 规则。
    - 遍历新的IP列表，为每个IP添加 `ALLOW` 规则。

3.  **管理脚本 (`mywhitessh`)**:
    - 提供一个用户友好的菜单，用于读取和修改配置文件，或手动触发更新和脚本升级。

## 📄 许可

本项目采用 [MIT License](LICENSE)。
